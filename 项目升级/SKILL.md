---
description: 旧项目复活器。用于维护、升级和重构现有项目的诊断优先工作流。
---

# /upgrade - 旧项目复活器

$ARGUMENTS

---

## 🚑 概述

此指令启动针对现有项目的 **诊断优先协议 (Diagnostic-First Protocol)**。与 `/start` 不同，它专注于理解、审计和外科手术式地改进现有代码库。

**工作流阶段：**

1. **深度扫描** (诊断与审计)
2. **战略规划** (重构 vs 重写)
3. **针对性执行** (修复、重构或重新设计)
4. **回归验证** (确保稳定性)

---

## 1. 深度扫描 (“健康检查”)

**动作：**
对当前代码库进行全面审计。

**步骤：**

1. **代码库映射：**
    - 调用 `explorer-agent` 生成目录树并理解架构。
2. **安全审计：**
    - 加载技能：`安全漏洞扫描`
    - 运行：`python scripts/security_scan.py .`
    - 目标：识别直接风险。
3. **代码质量审计：**
    - 加载技能：`代码审查清单`
    - 目标：识别“坏味道 (Smells)”、反模式和技术债务。
4. **性能检查 (仅限 Web)：**
    - 加载技能：`性能调优与分析`
    - 目标：识别 LCP/CLS 问题或包膨胀。

**输出：**

- 生成 `docs/AUDIT_REPORT.md` 总结所有发现。

---

## 2. 战略规划

**动作：**
审查 `docs/AUDIT_REPORT.md` 并定义升级路径。

**决策矩阵：**

- **小问题：** -> 进入 **路线 A (修复)**
- **技术债务 / 混乱代码：** -> 进入 **路线 B (重构)**
- **过时的 UI / 新设计：** -> 进入 **路线 C (重新设计)**
- **重大技术转变：** -> 调用 `/plan` 进行完整迁移规划。

**输出：**

- `docs/UPGRADE_PLAN.md` (如果复杂) 或简单任务列表。

---

## 3. 针对性执行

**根据决策矩阵执行：**

### 路线 A: 立即修复 (Fix)
>
> **触发：** Bug 报告，安全热修复。

- **动作：** 调用 `/debug` 工作流。
- **重点：** 根本原因分析 -> 修复 -> 预防。

### 路线 B: 结构性升级 (Refactor)
>
> **触发：** 框架升级 (例如：Next.js 14->15)，清理面条代码。

- **动作：** 调用 `/orchestrate` (阶段 2)。
- **强制技能：** `整洁代码规范` (Clean Code Standards)。
- **目标：** 提高可维护性而不破坏逻辑。

### 路线 C: UI 现代化 (Redesign)
>
> **触发：** "让它看起来现代一点", "换肤"。

- **动作：** 调用 `/ui-ux-pro-max`。
- **目标：** 更新 `tailwind.config`, 全局 CSS 和组件，同时保持业务逻辑完整。

---

## 4. 回归验证

**动作：**
确保“升级”没有破坏现有功能。

**步骤：**

1. **运行现有测试：**
    - `npm test` 或同等指令。
2. **差距分析：**
    - 加载技能：`测试技能`。
    - 识别测试覆盖率低的已修改区域。
    - 为更改的代码生成新测试。
3. **最终放行：**
    - 运行：`python scripts/checklist.py .`

---

## 使用示例

```bash
/upgrade audit and fix security issues
/upgrade migrate to Next.js 15
/upgrade refactor the auth module
/upgrade redesign the dashboard UI
```

**发生什么：**

1. 系统扫描代码和安全性。
2. 生成审计报告。
3. 规划具体的升级路径。
4. 执行特定智能体 (安全、后端或设计师)。
5. 验证无回归。
